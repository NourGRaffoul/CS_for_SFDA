
cuda is not avaiable.

==================================================
goal = test
device = cpu
device_id = 0
dataset = HAR
num_classes = 6
model = CNN
batch_size = 10
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 60
top_cnt = 100
local_epochs = 10
algorithm = FedAvg
join_ratio = 0.25
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 80
max_len = 200
few_shot = 0
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 0.1
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
num_candidates = 10
method = AFL
comment = _REDO
num_clients_per_round = 5
num_available = None
loss_div_sqrt = False
loss_sum = False
subset_ratio = 0.1
alpha1 = 0.75
alpha2 = 1
alpha3 = 0.1
save_probs = False
no_save_results = False
src_id = 1
imbalance_factor = 200.0
total_num_clients = 20
num_epoch = 10
wandb = True
==================================================

****** Client source: 1 *******
Accuracy of source client: 97.80%

============= Running time: 0th =============
Creating server and clients ...
CNN
Initializing client selection method: AFL
Pre-loading and preparing all client data...
INFO: Simulating imbalance with factor 200.0 for client 0 training data.
INFO: Simulating imbalance with factor 200.0 for client 1 training data.
INFO: Simulating imbalance with factor 200.0 for client 2 training data.
INFO: Simulating imbalance with factor 200.0 for client 3 training data.
INFO: Simulating imbalance with factor 200.0 for client 4 training data.
INFO: Simulating imbalance with factor 200.0 for client 5 training data.
INFO: Simulating imbalance with factor 200.0 for client 6 training data.
INFO: Simulating imbalance with factor 200.0 for client 7 training data.
INFO: Simulating imbalance with factor 200.0 for client 8 training data.
INFO: Simulating imbalance with factor 200.0 for client 9 training data.
INFO: Simulating imbalance with factor 200.0 for client 10 training data.
INFO: Simulating imbalance with factor 200.0 for client 11 training data.
INFO: Simulating imbalance with factor 200.0 for client 12 training data.
INFO: Simulating imbalance with factor 200.0 for client 13 training data.
INFO: Simulating imbalance with factor 200.0 for client 14 training data.
INFO: Simulating imbalance with factor 200.0 for client 15 training data.
INFO: Simulating imbalance with factor 200.0 for client 16 training data.
INFO: Simulating imbalance with factor 200.0 for client 17 training data.
INFO: Simulating imbalance with factor 200.0 for client 18 training data.
INFO: Simulating imbalance with factor 200.0 for client 19 training data.
Data loading complete.

Join ratio / total clients: 0.25 / 20
Finished creating server and clients.

------------- Round 0-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 0.8247
Averaged Test Accurancy: 0.7609
Averaged Test AUC: 0.8797
Std Test Accurancy: 0.1663
Std Test AUC: 0.0932
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [18 14  5 13 19]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [5, 13, 14, 18, 19]
------------------------- time cost ------------------------- 829.0281026363373

------------- Round 1-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.4106
Averaged Test Accurancy: 0.7939
Averaged Test AUC: 0.9414
Std Test Accurancy: 0.1501
Std Test AUC: 0.0726
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10 11  2 16  9]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 9, 10, 11, 16]
------------------------- time cost ------------------------- 661.8491134643555

------------- Round 2-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.3833
Averaged Test Accurancy: 0.7508
Averaged Test AUC: 0.8752
Std Test Accurancy: 0.1351
Std Test AUC: 0.0966
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10 17 12 15 11]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [10, 11, 12, 15, 17]
------------------------- time cost ------------------------- 664.9831521511078

------------- Round 3-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.6770
Averaged Test Accurancy: 0.7396
Averaged Test AUC: 0.8868
Std Test Accurancy: 0.1403
Std Test AUC: 0.0967
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 0  4 12  6 11]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 4, 6, 11, 12]
------------------------- time cost ------------------------- 546.1618812084198

------------- Round 4-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0466
Averaged Test Accurancy: 0.6772
Averaged Test AUC: 0.8961
Std Test Accurancy: 0.1375
Std Test AUC: 0.0871
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 6  2  8 16 17]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 6, 8, 16, 17]
------------------------- time cost ------------------------- 552.9196541309357

------------- Round 5-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.8062
Averaged Test Accurancy: 0.7198
Averaged Test AUC: 0.8993
Std Test Accurancy: 0.1390
Std Test AUC: 0.0916
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [14 13  2  5  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 5, 7, 13, 14]
------------------------- time cost ------------------------- 560.653222322464

------------- Round 6-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9172
Averaged Test Accurancy: 0.6898
Averaged Test AUC: 0.9121
Std Test Accurancy: 0.1790
Std Test AUC: 0.0912
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [11  6 12 10  8]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [6, 8, 10, 11, 12]
------------------------- time cost ------------------------- 555.5770366191864

------------- Round 7-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0903
Averaged Test Accurancy: 0.7487
Averaged Test AUC: 0.9001
Std Test Accurancy: 0.1512
Std Test AUC: 0.0991
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [19  0  8  2 18]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 2, 8, 18, 19]
------------------------- time cost ------------------------- 613.2687067985535

------------- Round 8-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5516
Averaged Test Accurancy: 0.5168
Averaged Test AUC: 0.8271
Std Test Accurancy: 0.1449
Std Test AUC: 0.0837
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 8  9 19  2  5]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 5, 8, 9, 19]
------------------------- time cost ------------------------- 432880.637768507

------------- Round 9-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0551
Averaged Test Accurancy: 0.7345
Averaged Test AUC: 0.8844
Std Test Accurancy: 0.1155
Std Test AUC: 0.0502
--- Training 20 clients ---
[34m[1mwandb[0m: [33mWARNING[0m Fatal error while uploading data. Some run data will not be synced, but it will still be written to disk. Use `wandb sync` at the end of the run to try uploading.
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 4 10 11 13 16]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 10, 11, 13, 16]
------------------------- time cost ------------------------- 499.0339503288269

------------- Round 10-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9157
Averaged Test Accurancy: 0.6604
Averaged Test AUC: 0.8307
Std Test Accurancy: 0.1346
Std Test AUC: 0.0787
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 2  6 19 18 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 6, 15, 18, 19]
------------------------- time cost ------------------------- 599.308272600174

------------- Round 11-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1941
Averaged Test Accurancy: 0.7142
Averaged Test AUC: 0.8538
Std Test Accurancy: 0.1775
Std Test AUC: 0.1208
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10  5 14 12  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [5, 7, 10, 12, 14]
------------------------- time cost ------------------------- 421.23691153526306

------------- Round 12-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0338
Averaged Test Accurancy: 0.6599
Averaged Test AUC: 0.8138
Std Test Accurancy: 0.1303
Std Test AUC: 0.1062
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [19 10 13 12 17]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [10, 12, 13, 17, 19]
------------------------- time cost ------------------------- 359.25063586235046

------------- Round 13-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1816
Averaged Test Accurancy: 0.5152
Averaged Test AUC: 0.8100
Std Test Accurancy: 0.1110
Std Test AUC: 0.0717
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 8  6 18 17 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [6, 8, 15, 17, 18]
------------------------- time cost ------------------------- 392.20309948921204

------------- Round 14-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1604
Averaged Test Accurancy: 0.6701
Averaged Test AUC: 0.8199
Std Test Accurancy: 0.1033
Std Test AUC: 0.0537
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [18  2  4  0  9]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 2, 4, 9, 18]
------------------------- time cost ------------------------- 357.2692792415619

------------- Round 15-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0604
Averaged Test Accurancy: 0.5579
Averaged Test AUC: 0.8091
Std Test Accurancy: 0.1316
Std Test AUC: 0.0892
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 5 17 10  0  8]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 5, 8, 10, 17]
------------------------- time cost ------------------------- 346.9639775753021

------------- Round 16-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.4565
Averaged Test Accurancy: 0.6827
Averaged Test AUC: 0.8289
Std Test Accurancy: 0.1399
Std Test AUC: 0.1062
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 3 13  8  4 14]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 4, 8, 13, 14]
------------------------- time cost ------------------------- 336.8750886917114

------------- Round 17-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.7959
Averaged Test Accurancy: 0.6792
Averaged Test AUC: 0.8439
Std Test Accurancy: 0.1504
Std Test AUC: 0.1263
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 6  8  7 13 16]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [6, 7, 8, 13, 16]
------------------------- time cost ------------------------- 332.16432523727417

------------- Round 18-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0047
Averaged Test Accurancy: 0.6665
Averaged Test AUC: 0.8528
Std Test Accurancy: 0.1218
Std Test AUC: 0.0942
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10  0  5 19  6]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 5, 6, 10, 19]
------------------------- time cost ------------------------- 319.30558490753174

------------- Round 19-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5915
Averaged Test Accurancy: 0.6315
Averaged Test AUC: 0.7758
Std Test Accurancy: 0.1549
Std Test AUC: 0.1195
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10 12 19 18 16]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [10, 12, 16, 18, 19]
------------------------- time cost ------------------------- 339.83041167259216

------------- Round 20-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.7138
Averaged Test Accurancy: 0.5472
Averaged Test AUC: 0.7440
Std Test Accurancy: 0.1919
Std Test AUC: 0.1347
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [13  7  9 10 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [7, 9, 10, 13, 15]
------------------------- time cost ------------------------- 726.3425376415253

------------- Round 21-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5504
Averaged Test Accurancy: 0.5254
Averaged Test AUC: 0.7725
Std Test Accurancy: 0.1067
Std Test AUC: 0.0845
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [14  4  5 11  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 5, 7, 11, 14]
------------------------- time cost ------------------------- 753.3502199649811

------------- Round 22-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.5969
Averaged Test Accurancy: 0.6203
Averaged Test AUC: 0.8230
Std Test Accurancy: 0.1618
Std Test AUC: 0.1070
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 5  0 19 17  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 5, 7, 17, 19]
------------------------- time cost ------------------------- 1552.097466468811

------------- Round 23-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1840
Averaged Test Accurancy: 0.6472
Averaged Test AUC: 0.7967
Std Test Accurancy: 0.1448
Std Test AUC: 0.1073
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 5 11  6  2  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 5, 6, 7, 11]
------------------------- time cost ------------------------- 321.83248353004456

------------- Round 24-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.8216
Averaged Test Accurancy: 0.6386
Averaged Test AUC: 0.8032
Std Test Accurancy: 0.1561
Std Test AUC: 0.1021
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [13 16  2  7 11]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 7, 11, 13, 16]
------------------------- time cost ------------------------- 529.2937324047089

------------- Round 25-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0676
Averaged Test Accurancy: 0.4315
Averaged Test AUC: 0.7042
Std Test Accurancy: 0.1016
Std Test AUC: 0.0687
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 4 17  2  0 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 2, 4, 15, 17]
------------------------- time cost ------------------------- 458.0888772010803

------------- Round 26-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1020
Averaged Test Accurancy: 0.6010
Averaged Test AUC: 0.7936
Std Test Accurancy: 0.1321
Std Test AUC: 0.0895
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 9  0  8 18  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 2, 8, 9, 18]
------------------------- time cost ------------------------- 415.47085213661194

------------- Round 27-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3127
Averaged Test Accurancy: 0.5629
Averaged Test AUC: 0.7679
Std Test Accurancy: 0.1201
Std Test AUC: 0.0609
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 0 19 18  6 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 6, 15, 18, 19]
------------------------- time cost ------------------------- 393.7462728023529

------------- Round 28-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.6052
Averaged Test Accurancy: 0.5310
Averaged Test AUC: 0.7615
Std Test Accurancy: 0.1276
Std Test AUC: 0.0978
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 8  1  2  9 10]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 2, 8, 9, 10]
------------------------- time cost ------------------------- 374.1993923187256

------------- Round 29-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9813
Averaged Test Accurancy: 0.5320
Averaged Test AUC: 0.7669
Std Test Accurancy: 0.0844
Std Test AUC: 0.0585
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10  1  7 15 13]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 7, 10, 13, 15]
------------------------- time cost ------------------------- 380.3437988758087

------------- Round 30-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2206
Averaged Test Accurancy: 0.4904
Averaged Test AUC: 0.6856
Std Test Accurancy: 0.1670
Std Test AUC: 0.1448
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [16 12  5 11 14]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [5, 11, 12, 14, 16]
------------------------- time cost ------------------------- 516.1813170909882

------------- Round 31-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1297
Averaged Test Accurancy: 0.4843
Averaged Test AUC: 0.7226
Std Test Accurancy: 0.1028
Std Test AUC: 0.0685
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [12  0 18 17  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 7, 12, 17, 18]
------------------------- time cost ------------------------- 542.4613635540009

------------- Round 32-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5266
Averaged Test Accurancy: 0.5746
Averaged Test AUC: 0.7654
Std Test Accurancy: 0.1443
Std Test AUC: 0.0991
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 6 15  3  4 12]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 4, 6, 12, 15]
------------------------- time cost ------------------------- 435.0376799106598

------------- Round 33-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3833
Averaged Test Accurancy: 0.5477
Averaged Test AUC: 0.7455
Std Test Accurancy: 0.1199
Std Test AUC: 0.0763
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [11 13  8  9 10]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [8, 9, 10, 11, 13]
------------------------- time cost ------------------------- 436.60452675819397

------------- Round 34-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3940
Averaged Test Accurancy: 0.6325
Averaged Test AUC: 0.7956
Std Test Accurancy: 0.1629
Std Test AUC: 0.1320
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 3 11  4  8 18]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 4, 8, 11, 18]
------------------------- time cost ------------------------- 530.9532988071442

------------- Round 35-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1096
Averaged Test Accurancy: 0.5579
Averaged Test AUC: 0.7444
Std Test Accurancy: 0.1783
Std Test AUC: 0.1434
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 4 12  5  6 18]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 5, 6, 12, 18]
------------------------- time cost ------------------------- 522.3746843338013

------------- Round 36-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3577
Averaged Test Accurancy: 0.5503
Averaged Test AUC: 0.7248
Std Test Accurancy: 0.1251
Std Test AUC: 0.0947
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 0  2  9  1 10]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 1, 2, 9, 10]
------------------------- time cost ------------------------- 572.8359270095825

------------- Round 37-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5370
Averaged Test Accurancy: 0.4909
Averaged Test AUC: 0.7086
Std Test Accurancy: 0.1381
Std Test AUC: 0.1088
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 9  8 18  6  3]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 6, 8, 9, 18]
------------------------- time cost ------------------------- 742.1367700099945

------------- Round 38-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.5650
Averaged Test Accurancy: 0.4843
Averaged Test AUC: 0.7026
Std Test Accurancy: 0.1065
Std Test AUC: 0.0657
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 3  8 16 12 14]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 8, 12, 14, 16]
------------------------- time cost ------------------------- 656.6808288097382

------------- Round 39-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.0418
Averaged Test Accurancy: 0.5086
Averaged Test AUC: 0.7253
Std Test Accurancy: 0.1582
Std Test AUC: 0.1422
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [13 19  7 16  8]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [7, 8, 13, 16, 19]
------------------------- time cost ------------------------- 568.5465912818909

------------- Round 40-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.7078
Averaged Test Accurancy: 0.3614
Averaged Test AUC: 0.6747
Std Test Accurancy: 0.0986
Std Test AUC: 0.0588
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 4  9 12 17 13]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 9, 12, 13, 17]
------------------------- time cost ------------------------- 585.3037481307983

------------- Round 41-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3165
Averaged Test Accurancy: 0.5467
Averaged Test AUC: 0.7208
Std Test Accurancy: 0.1313
Std Test AUC: 0.1055
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 4  1 16 17  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 2, 4, 16, 17]
------------------------- time cost ------------------------- 613.7184779644012

------------- Round 42-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9401
Averaged Test Accurancy: 0.5508
Averaged Test AUC: 0.7227
Std Test Accurancy: 0.1391
Std Test AUC: 0.1014
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [15  6 11 17  4]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 6, 11, 15, 17]
------------------------- time cost ------------------------- 704.8857383728027

------------- Round 43-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.8969
Averaged Test Accurancy: 0.4985
Averaged Test AUC: 0.6880
Std Test Accurancy: 0.0964
Std Test AUC: 0.0564
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [12  4 19 13 15]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [4, 12, 13, 15, 19]
------------------------- time cost ------------------------- 634.4243175983429

------------- Round 44-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.4249
Averaged Test Accurancy: 0.4949
Averaged Test AUC: 0.7139
Std Test Accurancy: 0.0947
Std Test AUC: 0.1028
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [17  6  3  4  1]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 3, 4, 6, 17]
------------------------- time cost ------------------------- 667.7801299095154

------------- Round 45-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1178
Averaged Test Accurancy: 0.5817
Averaged Test AUC: 0.7639
Std Test Accurancy: 0.1506
Std Test AUC: 0.1413
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 7  1 11  5 16]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 5, 7, 11, 16]
------------------------- time cost ------------------------- 670.9730522632599

------------- Round 46-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2440
Averaged Test Accurancy: 0.3787
Averaged Test AUC: 0.6123
Std Test Accurancy: 0.0842
Std Test AUC: 0.0519
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 9 13  1 18  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 2, 9, 13, 18]
------------------------- time cost ------------------------- 617.9601662158966

------------- Round 47-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3952
Averaged Test Accurancy: 0.5020
Averaged Test AUC: 0.7050
Std Test Accurancy: 0.1228
Std Test AUC: 0.0749
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [17  6  5 12  0]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 5, 6, 12, 17]
------------------------- time cost ------------------------- 452.2929377555847

------------- Round 48-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.3385
Averaged Test Accurancy: 0.5477
Averaged Test AUC: 0.7576
Std Test Accurancy: 0.1310
Std Test AUC: 0.1237
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [10  8 17 16 11]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [8, 10, 11, 16, 17]
------------------------- time cost ------------------------- 495.16836953163147

------------- Round 49-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9547
Averaged Test Accurancy: 0.5107
Averaged Test AUC: 0.6907
Std Test Accurancy: 0.1549
Std Test AUC: 0.1160
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 9  8 10 11  6]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [6, 8, 9, 10, 11]
------------------------- time cost ------------------------- 446.37720942497253

------------- Round 50-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2137
Averaged Test Accurancy: 0.4756
Averaged Test AUC: 0.6887
Std Test Accurancy: 0.1127
Std Test AUC: 0.0639
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 1 13  4 10  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 2, 4, 10, 13]
------------------------- time cost ------------------------- 493.79195618629456

------------- Round 51-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1553
Averaged Test Accurancy: 0.3482
Averaged Test AUC: 0.6232
Std Test Accurancy: 0.1033
Std Test AUC: 0.1004
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [12  9  3  8  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 3, 8, 9, 12]
------------------------- time cost ------------------------- 520.1346049308777

------------- Round 52-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2664
Averaged Test Accurancy: 0.4888
Averaged Test AUC: 0.7001
Std Test Accurancy: 0.1130
Std Test AUC: 0.0946
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [11  9 18  1  3]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 3, 9, 11, 18]
------------------------- time cost ------------------------- 509.3731801509857

------------- Round 53-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2033
Averaged Test Accurancy: 0.5579
Averaged Test AUC: 0.7429
Std Test Accurancy: 0.1574
Std Test AUC: 0.1295
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [12 16 19  8  2]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [2, 8, 12, 16, 19]
------------------------- time cost ------------------------- 503.4870984554291

------------- Round 54-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.4073
Averaged Test Accurancy: 0.4802
Averaged Test AUC: 0.6904
Std Test Accurancy: 0.1086
Std Test AUC: 0.0961
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 8 11  3  4  7]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [3, 4, 7, 8, 11]
------------------------- time cost ------------------------- 509.10899353027344

------------- Round 55-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 1.9867
Averaged Test Accurancy: 0.4442
Averaged Test AUC: 0.6769
Std Test Accurancy: 0.1102
Std Test AUC: 0.0627
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 3 10  2 14  0]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 2, 3, 10, 14]
------------------------- time cost ------------------------- 510.1568834781647

------------- Round 56-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1093
Averaged Test Accurancy: 0.5107
Averaged Test AUC: 0.6997
Std Test Accurancy: 0.1549
Std Test AUC: 0.1252
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 5  0 12  1  3]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [0, 1, 3, 5, 12]
------------------------- time cost ------------------------- 518.3877196311951

------------- Round 57-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.1431
Averaged Test Accurancy: 0.5051
Averaged Test AUC: 0.7035
Std Test Accurancy: 0.1474
Std Test AUC: 0.1221
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 1 10  2  4 13]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 2, 4, 10, 13]
------------------------- time cost ------------------------- 512.6838767528534

------------- Round 58-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.7079
Averaged Test Accurancy: 0.3350
Averaged Test AUC: 0.6385
Std Test Accurancy: 0.1101
Std Test AUC: 0.0859
--- Training 20 clients ---
> Post-training selection: choosing 5 from 20 trained clients.
>   (Using local losses as metric for AFL)
5 selected users: [ 5 10 13  3  1]
> Aggregating models from 5 final selected clients.
> Selected client IDs for this round: [1, 3, 5, 10, 13]
------------------------- time cost ------------------------- 514.3500487804413

------------- Round 59-------------
> Post-training selection enabled for method 'AFL'.
> Distributing global model to 20 clients.
> Sending global model to 20 clients for local training.

Evaluating global model before training...
Averaged Train Loss: 2.2875
Averaged Test Accurancy: 0.4827
Averaged Test AUC: 0.6858
Std Test Accurancy: 0.1337
Std Test AUC: 0.1171
--- Training 20 clients ---
Traceback (most recent call last):
  File "C:\Program Files\Python37\lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "C:\Program Files\Python37\lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\main.py", line 235, in <module>
    run(args, client_selection)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\main.py", line 145, in run
    server.train()
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\servers\serveravg.py", line 156, in train
    local_losses, accuracy, local_metrics = self.train_clients(clients_for_training)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\servers\serverbase.py", line 487, in train_clients
    train_result = client.train()
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\clients\clientavg.py", line 38, in train
    result=self.model.update(trainloader)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\algorithms\algorithms.py", line 103, in update
    pseudo_labels = self.obtain_pseudo_labels(trg_dataloader)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\algorithms\algorithms.py", line 156, in obtain_pseudo_labels
    features, _ = self.feature_extractor(inputs)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\module.py", line 889, in _call_impl
    result = self.forward(*input, **kwargs)
  File "C:\Users\owner\Downloads\Benchmark_Stage_backup2\Benchmark_Stage\system_shot_imbalance\flcore\algorithms\models.py", line 47, in forward
    x = self.conv_block1(x_in)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\module.py", line 889, in _call_impl
    result = self.forward(*input, **kwargs)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\container.py", line 119, in forward
    input = module(input)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\module.py", line 889, in _call_impl
    result = self.forward(*input, **kwargs)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\conv.py", line 263, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "C:\Users\owner\AppData\Roaming\Python\Python37\site-packages\torch\nn\modules\conv.py", line 260, in _conv_forward
    self.padding, self.dilation, self.groups)
KeyboardInterrupt
